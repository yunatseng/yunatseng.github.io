<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;Promise-Callback&quot;&gt;&lt;a href=&quot;#Promise-Callback&quot; class=&quot;headerlink&quot; title=&quot;Promise / Callback&quot;&gt;&lt;/a&gt;Promise / Callback&lt;/h2&gt;&lt;p&gt;假定有兩個函式 f1 和 f2，後者需等待前者的執行結果"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>常用的手法紀錄 | Yuna Tseng</title><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><meta name="generator" content="Hexo 5.0.2"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="../../../../index.html">Home</a><a class="sidebar-nav-item" href="../../../../archives">Archives</a></nav><div class="container post-meta"><div class="post-time">2020-08-24</div></div></div><div class="container post-header"><h1>常用的手法紀錄</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-Callback"><span class="toc-number">1.</span> <span class="toc-text">Promise &#x2F; Callback</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function-Programming"><span class="toc-number">2.</span> <span class="toc-text">Function Programming</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%87%AA%E8%A8%82%E4%B8%80%E5%80%8B-function%EF%BC%8C%E5%8F%AF%E5%B0%8D%E8%BC%B8%E5%85%A5-array-%E5%81%9A%E4%BB%BB%E6%84%8F%E8%A7%A3%E6%9E%90%EF%BC%86%E5%9B%9E%E5%82%B3%E6%89%80%E9%9C%80%E5%80%BC"><span class="toc-number">2.1.</span> <span class="toc-text">如何自訂一個 function，可對輸入 array 做任意解析＆回傳所需值</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="Promise-Callback"><a href="#Promise-Callback" class="headerlink" title="Promise / Callback"></a>Promise / Callback</h2><p>假定有兩個函式 f1 和 f2，後者需等待前者的執行結果</p>
<blockquote>
<p>f1( );<br>f2( );</p>
</blockquote>
<ol>
<li>假如 f1 是一個 fetch (或 axios )，那就先 call f1，讓他可以在背景做事，再讓 f2 來接 f1 的結果：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// f1 ...</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;f1&#x27;</span>);</span><br><span class="line">    res(<span class="string">&#x27;ya&#x27;</span>);</span><br><span class="line">&#125;)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f2 = <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(data);</span><br><span class="line"><span class="keyword">const</span> f3 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;f3&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> f4 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;f4&#x27;</span>);</span><br><span class="line"></span><br><span class="line">f1().then(f2)</span><br><span class="line">f3();</span><br><span class="line">f4();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f1</span><br><span class="line">f3</span><br><span class="line">f4</span><br><span class="line">ya</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>假如 f1 是一個迴圈，會 block 住整個執行程序，那可以把 f1 放在晚一點再 call，並傳給 f2：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;f1&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ya&#x27;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f2 = <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(data);</span><br><span class="line"><span class="keyword">const</span> f3 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;f3&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> f4 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;f4&#x27;</span>);</span><br><span class="line"></span><br><span class="line">f1().then(f2)</span><br><span class="line"></span><br><span class="line">f3();</span><br><span class="line">f4();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f3</span><br><span class="line">f4</span><br><span class="line">f1</span><br><span class="line">ya</span><br></pre></td></tr></table></figure>

<p>或是這樣改寫：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">　　　　<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;f1&#x27;</span>);</span><br><span class="line">　　　　　　<span class="comment">// f1 的任務程式碼</span></span><br><span class="line">　　　　　　callback();</span><br><span class="line">　　　　&#125;, <span class="number">1000</span>);</span><br><span class="line">　　&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f2 = <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(data);</span><br><span class="line"><span class="keyword">const</span> f3 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;f3&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> f4 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;f4&#x27;</span>);</span><br><span class="line"></span><br><span class="line">f1(<span class="function">() =&gt;</span> f2(<span class="string">&#x27;f2&#x27;</span>))</span><br><span class="line">f3()</span><br><span class="line">f4()</span><br></pre></td></tr></table></figure>

<p>不過秒數的部分通常很難判斷精準，有另一個 API 可以參考：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/queueMicrotask">https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/queueMicrotask</a>。<br>依然在 IE 上無法支援。</p>
<p>有另一種想法是事件驅動的模式：任務的執行不取決於程式碼的順序，而取決於某個事件是否發生。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1.on(<span class="string">&#x27;done&#x27;</span>, f2);</span><br></pre></td></tr></table></figure>

<p>但這種做法比較常見於操作 DOM 的時候，真正要綁定事件了話純 js 就要自己去實作 .on 的寫法，感覺蠻不容易的。</p>
<p>上述文字部份摘錄自：<a target="_blank" rel="noopener" href="https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/148940/">https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/148940/</a></p>
<h2 id="Function-Programming"><a href="#Function-Programming" class="headerlink" title="Function Programming"></a>Function Programming</h2><h3 id="如何自訂一個-function，可對輸入-array-做任意解析＆回傳所需值"><a href="#如何自訂一個-function，可對輸入-array-做任意解析＆回傳所需值" class="headerlink" title="如何自訂一個 function，可對輸入 array 做任意解析＆回傳所需值"></a>如何自訂一個 function，可對輸入 array 做任意解析＆回傳所需值</h3><p><em>範例 1</em>：回傳 array 的解析器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnNewArrValue</span>(<span class="params">arr, fn</span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> newArr = []</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">    newArr.push(fn(arr[i]))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> newArr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// y(arr2) = f(x) 此處 f 為 (j)=&gt;j*2, x 為 [1,2,3]，也等於欲傳進去的 j。</span></span><br><span class="line"><span class="keyword">let</span> arr2 = returnNewArrValue([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="function">(<span class="params">j</span>)=&gt;</span>j*<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr2) <span class="comment">// [2, 4, 6]</span></span><br><span class="line"><span class="comment">// 上方的 (arr[i]) 為此處的 j，故上方的 fn(arr[i]) = fn(j)</span></span><br><span class="line"><span class="comment">// 並得到回傳的 j*2 push 進 newArr 中</span></span><br></pre></td></tr></table></figure>

<p><em>範例 2</em>：幫 array 加一個 <code>any</code> 的 function，可以輸入任一 function 做<code>是否 &gt;0</code>的判斷，如果 array 裡<code>存在（∃）</code>任何一個值 &gt; 0 則回傳 true，否則回傳 false。<br>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].any(isGreaterThanZero); <span class="comment">//=&gt; true</span></span><br><span class="line">[<span class="number">-1</span>, <span class="number">0</span>].any(isGreaterThanZero); <span class="comment">//=&gt; false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>思路 1：Array 要加上 any 方法可用 prototype 掛上去</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.any = <span class="comment">//某個方法（function）.....</span></span><br></pre></td></tr></table></figure>

<ul>
<li>思路 2：要<code>可接受任意 function</code> 代表 any 的參數需要一個 callback 來處理 array 裡面的數值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.any = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 此處的 this 因為 call 法為 arr.any(cb)，故 this 指向調用者，也就是該 arr</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="built_in">this</span>.length; i++)&#123;</span><br><span class="line">        <span class="comment">// 把當前項目傳進去 cb 做處理，若數值成立，則回傳 true 並中止函式，</span></span><br><span class="line">        <span class="comment">// 不停循環至 for 迴圈結束</span></span><br><span class="line">        <span class="keyword">if</span>(cb(<span class="built_in">this</span>[i])) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isGreaterThanZero</span>(<span class="params">i</span>)</span>&#123;<span class="keyword">return</span> i &gt; <span class="number">0</span>&#125;</span><br><span class="line">[<span class="number">1</span>,<span class="number">-1</span>].any(isGreaterThanZero) <span class="comment">// true</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].any(isGreaterThanZero) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>思路 3：此問題也等同於 Array.prototype.some 的效果，可參考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/some">https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/some</a></li>
</ul>
<p><em>額外範例</em>:幫 array 加一個 <code>all</code> 的 function，可以輸入任一 function 做<code>是否 &gt;0</code>的判斷，如果 array 裡<code>任何（∀）</code>一個值都是 &gt; 0 則回傳 true，否則回傳 false。</p>
<p>寫法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.all = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="built_in">this</span>.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cb(<span class="built_in">this</span>[i])) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isGreaterThanZero</span>(<span class="params">i</span>)</span>&#123;<span class="keyword">return</span> i &gt; <span class="number">0</span>&#125;</span><br><span class="line">[<span class="number">1</span>,<span class="number">-1</span>].all(isGreaterThanZero) <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].all(isGreaterThanZero) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>思路 4：此問題也等同於 Array.prototype.every 的效果，可參考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/every">https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/every</a></li>
</ul>
<p>上述文字部分參考自：<a target="_blank" rel="noopener" href="https://github.com/aszx87410/blog/issues/15">https://github.com/aszx87410/blog/issues/15</a></p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'yunatsengblog';
var disqus_identifier = '2020/08/24/常用的手法紀錄/';
var disqus_title = '常用的手法紀錄';
var disqus_url = 'http://yoursite.com/2020/08/24/%E5%B8%B8%E7%94%A8%E7%9A%84%E6%89%8B%E6%B3%95%E7%B4%80%E9%8C%84/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a target="_blank" rel="noopener" href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>